<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<%@ page import="java.sql.*" %>
<%@ page import="javax.sql.*" %>
<%@ page import="javax.naming.*" %>
<%@ page import="java.util.Date" %>
<%--@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"--%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Show world cities</title>
</head>
<body>
<h1>
<%
Connection conn = null;
//out.println(jndiName);
Statement stmt = null;
ResultSet rs = null;
try{
	Context initCtx = new InitialContext();
	DataSource ds = (DataSource)initCtx.lookup("java:comp/env/jndi/world");
	conn = ds.getConnection();
	stmt = conn.createStatement();
	String sql = "";
	//if(countryName == null)
		sql = "select t1.name as cityName, t2.name as countryName  " 
				+" from city t1 inner join country t2 " 
				+" on t1.countryCode = t2.code";
	//else
	//	sql = "select t1.name as cityName, t2.name as countryName  " 
	//			+" from city t1 inner join country t2 " 
	//			+" on t1.countryCode = t2.code where t2.name like '%"+countryName + "%'";
	rs = stmt.executeQuery(sql);
	int i = 0;
	
	out.println(new Date());
	while(rs.next()){
		if(i >= 10)
			break;
		out.println("ciytName: " + rs.getString(1) + ", country name: " + rs.getString(2) + "<br/>");
		i++;
	}
}
catch(Exception ex){
	out.println(ex);
}
%>
<%--
String countryName = null;
Connection conn = null;
String jndiName = "java:comp/env/jdbc/world";
//also can use;
//String jndiName = "jdbc/world";
Context ctx = new InitialContext();
Statement stmt = null;
ResultSet rs = null;
try{
	DataSource ds = (DataSource)ctx.lookup(jndiName);
	conn = ds.getConnection();
	stmt = conn.createStatement();
	String sql = "";
	if(countryName == null)
		sql = "select t1.name as cityName, t2.name as countryName  " 
				+" from city t1 inner join country t2 " 
				+" on t1.countryCode = t2.code";
	else
		sql = "select t1.name as cityName, t2.name as countryName  " 
				+" from city t1 inner join country t2 " 
				+" on t1.countryCode = t2.code where t2.name like '%"+countryName + "%'";
	rs = stmt.executeQuery(sql);
	for(int i = 0;i<10;i++){
		out.println("ciytName: " + rs.getString(0) + "; CountryName:" + rs.getString(1) + "<br/>");
	}
}
catch(Exception ex){
	System.out.println(ex);
}
--
--%>
</h1>
</body>
</html>